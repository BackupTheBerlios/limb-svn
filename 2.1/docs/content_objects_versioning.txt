Версионность объектов.

Любой контентный объект поддерживает версионность. Это значит, что когда 
пользователь изменяет объект, то ему присваивается очередной индекс версии и 
сохраняется как полная копия его текущего состояния, так и его состояние до 
модификации. К сожалению, мы еще не ввели признак «Незначительные изменения» для 
того, чтобы не записывать новое состояние при каждом редактировании объекта. 
Возможно, это приводит к лишней потере места на диске.

Для каждой версией объекта храниться дата ее создания, последнего изменения, 
пользователь, который создал версию объекта.

Необходимость записи новой версии определяется в content_object :: 
update($create_new_version):

class edit_user_action extends form_edit_site_object_action
{
	// … some code here
	function _update_object_operation()
	{
		if(!$this->object->update(false))
			return false;
		else
			return true;
	}
}

Для того чтобы просмотреть список версий объекта, а также состояние объекта в любой из 
его версий, создать версию из уже существующей в контроллер объекта необходимо 
добавить описание на соответствующее действие, например:

class document_controller extends site_object_controller
{
	function document_controller()
	{
		$this->_actions = array(
				// some more actions here
				'admin_detail' => array(
						'permissions_required' => 'r',
						'template_path' => '/admin/object_detail_info.html',
						'popup' => true,
						'JIP' => true,
						'img_src' => '/shared/images/admin_detail.gif',
						'action_name' => strings :: get('detail_info'),
				),
		);

		parent :: site_object_controller();
	}
}

Для корректной работы необходим объект класса version, который должен располагаться 
по пути /root/version. Для пользователя должны быть разрешены действия display и 
recover.

class version_controller extends site_object_controller
{
	function version_controller()
	{
		$this->_actions = array(
				'display' => array(
						'permissions_required' => 'r',
						'template_path' => '/version/display.html',
				),
				'recover' => array(
						'permissions_required' => 'r',
						'action_path' => '/version/recover_version_action', 
						'popup' => true
				)
		);
 		

		parent :: site_object_controller();
	}
} 

шаблон object_detail_info.html отображает системные данные об объекте, а также список 
всех версий объекта.

/version/display.html отображает состояние всех атрибутов объекта указанной версии.

Recover_version_action – создает новую версию объекта из указанной.

Версионность в LIMB еще находится в зачаточном состоянии. Возможно, в будущем 
будет изменения даже структура базы данных. Мы готовы обсуждать вопросы 
версионности объектов. Если у нас будет проект, который будет использовать эту 
функциональность, тогда будет и значительные улучшения в данном вопросе. 




